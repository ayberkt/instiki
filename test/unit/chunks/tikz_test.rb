#!/usr/bin/env ruby

require File.expand_path(File.dirname(__FILE__) + '/../../test_helper')
require 'chunks/tikz'
require 'nokogiri'

class TikzTest < Test::Unit::TestCase
  include ChunkMatch

if ENV['tikz_server']

  def test_simple_tikzpicture
  match_pattern(Tikz, '\begin{tikzpicture}a\end{tikzpicture}',
    :plain_text => 'a',
    :unmask_text => Regexp.new("<svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\"" +
    " width=\"388.543pt\" height=\"0pt\" viewBox=\"0 0 388.543 0\" version=\"1.1\">\n<g id=\"surface[0-9]+-1\">\n</g>\n</svg>")
  )
  end

  def test_equation_nowiki
  match_pattern(Tikz, '\begin{tikzpicture}\node[anchor=east] at (-1,-0.5) {$a$};\end{tikzpicture}',
    :plain_text => Regexp.new('\\\node\[anchor=east\] at \(-1,-0\.5\) \{\$a\$\};'),
    :unmask_text => Regexp.new("<svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\" w" +
    "idth=\"14.824pt\" height=\"13.759pt\" viewBox=\"0 0 14.824 13.759\" version=\"1.1\">\n<defs>\n<g>\n<symbol overflow=\"visib" +
    "le\" id=\"glyph[0-9]+-0-0\">\n<path style=\"stroke:none;\" d=\"M 3.828125 -2.03125 L 3.828125 -2.21875 C 3.828125 -3.53125 5.75 -4" +
    ".453125 5.75 -6.21875 C 5.75 -7.453125 4.703125 -8 3.53125 -8 C 2.328125 -8 1.5 -7.3125 1.5 -6.34375 C 1.5 -5.78125 1.73437" +
    "5 -5.515625 2.109375 -5.515625 C 2.40625 -5.515625 2.65625 -5.671875 2.65625 -6.03125 C 2.65625 -6.484375 2.40625 -6.5 2.40" +
    "625 -6.890625 C 2.40625 -7.265625 2.71875 -7.546875 3.4375 -7.546875 C 4.203125 -7.546875 4.671875 -7.125 4.671875 -6.1875 " +
    "C 4.671875 -4.34375 3.34375 -3.890625 3.34375 -2.34375 L 3.34375 -2.03125 Z M 4.28125 -0.578125 C 4.28125 -0.9375 4.03125 -" +
    "1.28125 3.609375 -1.28125 C 3.171875 -1.28125 2.90625 -0.953125 2.90625 -0.578125 C 2.90625 -0.171875 3.125 0.09375 3.59375" +
    " 0.09375 C 4.03125 0.09375 4.28125 -0.1875 4.28125 -0.578125 Z M 7.109375 2.015625 L 7.109375 -9.390625 L 0.125 -9.390625 L" +
    " 0.125 2.015625 Z M 6.484375 1.390625 L 0.734375 1.390625 L 0.734375 -8.78125 L 6.484375 -8.78125 Z( M 6.484375 1.390625){0,1} \"\/>\n<\/symbol>\n<sym" +
    "bol overflow=\"visible\" id=\"glyph[0-9]+-0-1\">\n<path style=\"stroke:none;\" d=\"M 6 -5.640625 L 5.359375 -5.640625 L 4.9375 -5." +
    "09375 L 4.890625 -5.09375 C 4.6875 -5.390625 4.296875 -5.71875 3.6875 -5.71875 C 1.984375 -5.71875 0.609375 -3.9375 0.59375" +
    " -1.640625 C 0.578125 -0.4375 1.203125 0.140625 2 0.140625 C 2.6875 0.140625 3.4375 -0.25 4.046875 -1.015625 L 4.140625 -1." +
    "015625 C 4.09375 -0.796875 4.046875 -0.640625 4.046875 -0.421875 C 4.046875 -0.078125 4.296875 0.125 4.703125 0.125 C 5.468" +
    "75 0.125 5.953125 -0.421875 6.4375 -1.15625 L 6.203125 -1.34375 C 6.046875 -1.140625 5.703125 -0.71875 5.3125 -0.71875 C 5." +
    "125 -0.71875 5.078125 -0.8125 5.078125 -0.96875 C 5.078125 -1.140625 5.140625 -1.40625 5.140625 -1.40625 Z M 4.65625 -4.140" +
    "625 C 4.65625 -3.734375 4.4375 -2.625 4.3125 -2.15625 C 4.09375 -1.296875 3.3125 -0.640625 2.5625 -0.640625 C 2.015625 -0.6" +
    "40625 1.65625 -0.953125 1.65625 -2.015625 C 1.65625 -3.640625 2.421875 -5.265625 3.609375 -5.265625 C 4.28125 -5.265625 4.6" +
    "5625 -4.71875 4.65625 -4.140625 Z( M 4.65625 -4.140625){0,1} \"\/>\n<\/symbol>\n<\/g>\n<\/defs>\n<g id=\"surface[0-9]+-1\">\n<g style=\"fill:rgb\\(0%," +
    "0%,0%\\);fill-opacity:1;\">\n  <use xlink:href=\"#glyph[0-9]+-0-1\" x=\"3.945\" y=\"9.695\"\/>\n<\/g>\n<\/g>\n<\/svg>")
  )
  end
end
end

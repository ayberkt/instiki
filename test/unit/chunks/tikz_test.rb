#!/usr/bin/env ruby

require File.expand_path(File.dirname(__FILE__) + '/../../test_helper')
require 'chunks/tikz'
require 'nokogiri'

class TikzTest < Test::Unit::TestCase
  include ChunkMatch

if ENV['tikz_server']

  def test_simple_tikzpicture
  match_pattern(Tikz, '\begin{tikzpicture}a\end{tikzpicture}',
    :plain_text => 'a',
    :unmask_text => Regexp.new("<svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\"" +
    " width=\"343.711pt\" height=\"0pt\" viewBox=\"0 0 343.711 0\" version=\"1.1\">\n<g id=\"surface[0-9]+-1\">\n</g>\n</svg>")
  )
  end

  def test_equation_nowiki
  match_pattern(Tikz, '\begin{tikzpicture}\node[anchor=east] at (-1,-0.5) {$a$};\end{tikzpicture}',
    :plain_text => Regexp.new('\\\node\[anchor=east\] at \(-1,-0\.5\) \{\$a\$\};'),
    :unmask_text => Regexp.new("<svg xmlns=\"http:\/\/www.w3.org\/2000\/svg\" xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\" " +
    "width=\"12.353pt\" height=\"11.466pt\" viewBox=\"0 0 12.353 11.466\" version=\"1.1\">\n<defs>\n<g>\n<symbol overflow=\"vis" +
    "ible\" id=\"glyph[0-9]+-0-0\">\n<path style=\"stroke:none;\" d=\"M 3.1875 -1.6875 L 3.1875 -1.859375 C 3.1875 -2.9375 4.79" +
    "6875 -3.71875 4.796875 -5.1875 C 4.796875 -6.21875 3.921875 -6.671875 2.953125 -6.671875 C 1.9375 -6.671875 1.25 -6.09375 " +
    "1.25 -5.296875 C 1.25 -4.828125 1.453125 -4.59375 1.765625 -4.59375 C 2 -4.59375 2.21875 -4.71875 2.21875 -5.03125 C 2.218" +
    "75 -5.40625 2 -5.421875 2 -5.75 C 2 -6.0625 2.265625 -6.296875 2.859375 -6.296875 C 3.5 -6.296875 3.890625 -5.9375 3.89062" +
    "5 -5.15625 C 3.890625 -3.625 2.796875 -3.25 2.796875 -1.953125 L 2.796875 -1.6875 Z M 3.5625 -0.484375 C 3.5625 -0.78125 3" +
    ".359375 -1.0625 3.015625 -1.0625 C 2.640625 -1.0625 2.421875 -0.796875 2.421875 -0.484375 C 2.421875 -0.15625 2.609375 0.0" +
    "78125 3 0.078125 C 3.359375 0.078125 3.5625 -0.15625 3.5625 -0.484375 Z M 5.9375 1.6875 L 5.9375 -7.828125 L 0.09375 -7.82" +
    "8125 L 0.09375 1.6875 Z M 5.40625 1.15625 L 0.609375 1.15625 L 0.609375 -7.3125 L 5.40625 -7.3125 Z M 5.40625 1.15625 \"\/>" +
    "\n<\/symbol>\n<symbol overflow=\"visible\" id=\"glyph[0-9]+-0-1\">\n<path style=\"stroke:none;\" d=\"M 5 -4.703125 L 4.46875" +
    " -4.703125 L 4.109375 -4.25 L 4.078125 -4.25 C 3.90625 -4.5 3.59375 -4.78125 3.078125 -4.78125 C 1.65625 -4.78125 0.515625" +
    " -3.28125 0.5 -1.359375 C 0.484375 -0.359375 1 0.125 1.671875 0.125 C 2.25 0.125 2.859375 -0.203125 3.375 -0.84375 L 3.453" +
    "125 -0.84375 C 3.421875 -0.671875 3.375 -0.53125 3.375 -0.34375 C 3.375 -0.0625 3.59375 0.09375 3.921875 0.09375 C 4.5625 " +
    "0.09375 4.96875 -0.34375 5.375 -0.96875 L 5.171875 -1.109375 C 5.046875 -0.953125 4.75 -0.59375 4.4375 -0.59375 C 4.28125 " +
    "-0.59375 4.234375 -0.671875 4.234375 -0.8125 C 4.234375 -0.953125 4.28125 -1.171875 4.28125 -1.171875 Z M 3.875 -3.453125 " +
    "C 3.875 -3.109375 3.703125 -2.1875 3.59375 -1.796875 C 3.40625 -1.078125 2.765625 -0.53125 2.140625 -0.53125 C 1.671875 -0" +
    ".53125 1.375 -0.796875 1.375 -1.671875 C 1.375 -3.03125 2.015625 -4.390625 3.015625 -4.390625 C 3.5625 -4.390625 3.875 -3." +
    "9375 3.875 -3.453125 Z M 3.875 -3.453125 \"\/>\n<\/symbol>\n<\/g>\n<\/defs>\n<g id=\"surface[0-9]+-1\">\n<g style=\"fill:rgb\\(0\%" +
    ",0%,0%\\);fill-opacity:1;\">\n  <use xlink:href=\"#glyph[0-9]+-0-1\" x=\"3.287\" y=\"8.079\"\/>\n<\/g>\n<\/g>\n<\/svg>")
  )
  end
end
end
